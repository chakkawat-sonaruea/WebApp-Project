<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="./styles/reset.css"> -->
    <link rel="stylesheet" href="./styles/style.css">

    <!-- Catamaren Font Thin-100, Light-300, Regular-400, Medium-500, Bold-700 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@100;300;400;500;700&display=swap" rel="stylesheet">

    <!-- Prompt Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500&display=swap" rel="stylesheet">

    <title>Covid19 Stats</title>

    <!-- https://covid19.ddc.moph.go.th/ -->
</head>

<body>

    <h2>Covid Tracker</h2>
    <center>
        <p>Today new case: </p>
        </br>
        <p id="today-case"></p>
        <br>
        <p>Yesterday new case: </p>
        </br>
        <p id="yesterday-case"></p><br>
    </center>
    </br>
    <div>
        <form>
            <div id="auto-complete">
                <input id="country-input" type="text" placeholder="country">
            </div>
            <input type="date" name="" id="data-pick">
            <input id="submit-button" type="submit" value="show data">

        </form>
    </div>
</body>

<script>
    /* api section */
    const todayCaseURL = "https://covid19.ddc.moph.go.th/api/Cases/today-cases-all"
    const timelineCaseeURL = "https://covid19.ddc.moph.go.th/api/Cases/timeline-cases-all"
    const stats = document.getElementById("stats");
    const submitButton = document.getElementById("submit-button");
    const todayCase = document.getElementById("today-case");
    const yesterdayCase = document.getElementById("yesterday-case");
    const endl = "\n";


    /*
    function getTimelineStats() {
        fetch(timelineCaseeURL)
            .then(responseToJSON)
            .then(reverseObject)
            .then(data => {
                let today = data[0],
                    yesterday = data[1];
                updateTextContent("new-case", today.new_case);
                updateTextContent("yesterday-new-case", yesterday.new_case);

            })
            .then(data => {
                console.log(data)
            })
    }

    getTimelineStats();
    */
    let timelineStats;

    function getTimelineStats() {
        return fetch(timelineCaseeURL)
            .then(responseToJSON)
            .then(reverseObject)
            .then(data => {
                updateTextContent("today-case", data[0].new_case);
                updateTextContent("yesterday-case", data[1].new_case);
            })
            .then(data => {
                return data
            })
    }

    function printRequest(url) {
        fetch(url)
            .then(responseToJSON)
            .then(console.log(data))
    }

    timelineStats = getTimelineStats();

    console.log(timelineStats);
    submitButton.addEventListener("click", e => {
        console.log(timelineStats)
        today = timelineStats[0]
        yesterday = timelineStats[1]
        // message =
        // "Today new case :" + " " + today.new_case + endl +
        // "Yesterday new case :" + " " + yesterday.new_case + endl
        alert(message)
    })


    function responseToJSON(r) {
        return r.json()
    }

    function reverseObject(object) {
        return object.reverse()
    }

    function updateTextContent(id, data) {
        element = document.getElementById(id);
        if (element.textContent == null)
            element.textContent = data
        else
            element.textContent += " " + data

    }

    /* autoComplete Input section */
    const thaiCountries = [
        "เชียงราย",
        "เชียงใหม่",
        "น่าน",
        "พะเยา",
        "แพร่",
        "แม่ฮ่องสอน",
        "ลำปาง",
        "ลำพูน",
        "อุตรดิตถ์",
        "กาฬสินธุ์",
        "ขอนแก่น",
        "ชัยภูมิ",
        "นครพนม",
        "นครราชสีมา",
        "บึงกาฬ",
        "บุรีรัมย์",
        "มหาสารคาม",
        "มุกดาหาร",
        "ยโสธร",
        "ร้อยเอ็ด",
        "เลย",
        "สกลนคร",
        "สุรินทร์",
        "ศรีสะเกษ",
        "หนองคาย",
        "หนองบัวลำภู",
        "อุดรธานี",
        "อุบลราชธานี",
        "อำนาจเจริญ",
        "กำแพงเพชร",
        "ชัยนาท",
        "นครนายก",
        "นครปฐม",
        "นครสวรรค์",
        "นนทบุรี",
        "ปทุมธานี",
        "พระนครศรีอยุธยา",
        "พิจิตร",
        "พิษณุโลก",
        "เพชรบูรณ์",
        "ลพบุรี",
        "สมุทรปราการ",
        "สมุทรสงคราม",
        "สมุทรสาคร",
        "สิงห์บุรี",
        "สุโขทัย",
        "สุพรรณบุรี",
        "สระบุรี",
        "อ่างทอง",
        "อุทัยธานี",
        "จันทบุรี",
        "ฉะเชิงเทรา",
        "ชลบุรี",
        "ตราด",
        "ปราจีนบุรี",
        "ระยอง",
        "สระแก้ว",
        "กาญจนบุรี",
        "ตาก",
        "ประจวบคีรีขันธ์",
        "เพชรบุรี",
        "ราชบุรี",
        "กระบี่",
        "ชุมพร",
        "ตรัง",
        "นครศรีธรรมราช",
        "นราธิวาส",
        "ปัตตานี",
        "พังงา",
        "พัทลุง",
        "ภูเก็ต",
        "ระนอง",
        "สตูล",
        "สงขลา",
        "สุราษฎร์ธานี",
        "ยะล",
    ]

    const countryInput = document.getElementById("country-input")
    const autoCompleteList = document.createElement("div");
    const autoComplete = document.getElementById("auto-complete");
    countryInput.addEventListener("input", reactToInput)
    autoCompleteList.setAttribute("class", "auto-complete-list");
    autoComplete.appendChild(autoCompleteList)

    function reactToInput(event) {
        clearSuggestion()
        if (this.value == "" || this.value == null)
            return
        let result = thaiCountries
            .filter(countryName => countryName.includes(this.value))
            .forEach(createSuggestion)
        console.log(result)

    }

    function clearSuggestion() {
        suggestions = document.querySelectorAll(".auto-complete-items");
        suggestions.forEach(e => autoCompleteList.removeChild(e))
    }

    function createSuggestion(suggestionName) {
        suggestionItem = document.createElement("div");
        suggestionItem.setAttribute("class", "auto-complete-items")
        suggestionItem.textContent = suggestionName;
        autoCompleteList.appendChild(suggestionItem);
    }
    // https://stackoverflow.com/questions/10576905/how-to-convert-javascript-unicode-notation-code-to-utf-8
</script>

</html>
